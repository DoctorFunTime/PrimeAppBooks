<Window
    x:Class="PrimeAppBooks.Views.Windows.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:fw="clr-namespace:SourceChord.FluentWPF;assembly=FluentWPF"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:views="clr-namespace:PrimeAppBooks.Views.Controls"
    Title="PrimeApp Books"
    Width="1310"
    Height="700"
    MinWidth="980"
    MinHeight="560"
    AllowsTransparency="True"
    Background="Transparent"
    FontFamily="Century Gothic"
    ResizeMode="CanResizeWithGrip"
    WindowStartupLocation="CenterScreen"
    WindowStyle="None"
    mc:Ignorable="d">

    <Grid Margin="10">
        <!--  Beautiful Stepped Gradient Background  -->
        <!--  First gradient: Diagonal top-left to bottom-right  -->

        <!--  Shadow Border - positioned behind main content  -->
        <Border
            Margin="5"
            Panel.ZIndex="0"
            Background="#40000000"
            CornerRadius="8">
            <!--  This creates a simple shadow effect  -->
        </Border>

        <!--  Main Content Grid with Drop Shadow Effect  -->
        <Grid Panel.ZIndex="1">
            <Grid.Effect>
                <DropShadowEffect
                    BlurRadius="8"
                    Direction="315"
                    Opacity="0.5"
                    RenderingBias="Quality"
                    ShadowDepth="2"
                    Color="#60000000" />
            </Grid.Effect>

            <Rectangle RadiusX="8" RadiusY="8">
                <Rectangle.Fill>
                    <StaticResource ResourceKey="BackgroundGradient1" />
                </Rectangle.Fill>
            </Rectangle>

            <!--  Second gradient: Diagonal bottom-left to top-right  -->
            <Rectangle
                Opacity="0.5"
                RadiusX="8"
                RadiusY="8">
                <Rectangle.Fill>
                    <StaticResource ResourceKey="BackgroundGradient2" />
                </Rectangle.Fill>
                <Rectangle.OpacityMask>
                    <StaticResource ResourceKey="BackgroundMaskGradient" />
                </Rectangle.OpacityMask>
            </Rectangle>

            <!--  Main Glass Overlay with Transparency  -->
            <fw:AcrylicPanel
                NoiseOpacity="0.005"
                Opacity="0.9"
                TintColor="#0a0a0a"
                TintOpacity="0.1">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <!--  Enhanced Title Bar with Shadow  -->
                    <Grid Grid.Row="0" Height="50">
                        <Border CornerRadius="8,8,0,0" MouseLeftButtonDown="Border_MouseLeftButtonDown">
                            <Border.Background>
                                <StaticResource ResourceKey="TitleBarGradient" />
                            </Border.Background>
                            <DockPanel Margin="5" LastChildFill="False">
                                <!--  App Title with Icon and Toggle Button  -->
                                <StackPanel
                                    VerticalAlignment="Center"
                                    DockPanel.Dock="Left"
                                    Orientation="Horizontal">
                                    <Button
                                        Margin="0,0,12,0"
                                        Command="{Binding ToggleSidebarCommand}"
                                        Content="☰"
                                        Style="{StaticResource ToggleButtonStyle}" />
                                    <Image
                                        x:Name="image"
                                        Height="45"
                                        Margin="0,0,5,0"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"
                                        RenderOptions.BitmapScalingMode="HighQuality"
                                        Source="/Images/NewLogoIconDark.png"
                                        Stretch="Uniform" />
                                    <StackPanel>
                                        <TextBlock
                                            FontFamily="Century Gothic"
                                            FontSize="17"
                                            FontWeight="SemiBold"
                                            Foreground="White"
                                            Text="PrimeApp Books" />
                                        <TextBlock
                                            Margin="2"
                                            FontFamily="Century Gothic"
                                            FontSize="11"
                                            Foreground="#D0FFFFFF"
                                            Text="Financial Management Suite" />
                                    </StackPanel>
                                </StackPanel>

                                <!--  Window Controls with ViewModel Commands - Now properly right-aligned  -->
                                <StackPanel
                                    Margin="0,0,0,0"
                                    VerticalAlignment="Center"
                                    DockPanel.Dock="Right"
                                    Orientation="Horizontal">
                                    <Button
                                        Margin="2,0"
                                        Command="{Binding MinimizeCommand}"
                                        CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=Window}}"
                                        Content="─"
                                        Style="{StaticResource TitleBarButtonStyle}" />
                                    <Button
                                        Margin="2,0"
                                        Command="{Binding MaximizeCommand}"
                                        CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=Window}}"
                                        Content="⬜"
                                        Style="{StaticResource TitleBarButtonStyle}" />
                                    <Button
                                        Margin="2,0"
                                        Command="{Binding CloseCommand}"
                                        CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=Window}}"
                                        Content="✕"
                                        Style="{StaticResource CloseButtonStyle}" />
                                </StackPanel>
                            </DockPanel>
                        </Border>
                    </Grid>

                    <!--  Main Content with Floating Panels  -->
                    <Grid Grid.Row="1" Margin="10">
                        <!--  Increased left/right margin to push sidebar right  -->
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="{Binding SidebarWidth}" />
                            <ColumnDefinition Width="16" />
                            <!--  Increased sidebar margin  -->
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <!--  Floating Sidebar with Shadow and Collapsible Functionality  -->
                        <Grid Grid.Column="0">
                            <!--  Main Sidebar Panel with rounded edges  -->
                            <Border CornerRadius="12" Background="#D0000000">
                                <Border.Effect>
                                    <DropShadowEffect
                                        BlurRadius="10"
                                        ShadowDepth="3"
                                        Direction="315"
                                        Color="#40000000"
                                        Opacity="0.5" />
                                </Border.Effect>
                                <Grid>
                                    <!--  Expanded Sidebar Content  -->
                                    <ScrollViewer VerticalScrollBarVisibility="Hidden" Style="{StaticResource ModernScrollViewer}" Visibility="{Binding SidebarContentVisibility}">
                                        <StackPanel Margin="10">
                                            <Border
                                                        Margin="0,0,0,28"
                                                        Padding="20"
                                                        CornerRadius="16">
                                                <Border.Background>
                                                    <StaticResource ResourceKey="UserProfileGradient" />
                                                </Border.Background>
                                                <StackPanel>
                                                    <Ellipse
                                                                Width="52"
                                                                Height="52"
                                                                Margin="0,0,0,12">
                                                        <Ellipse.Fill>
                                                            <StaticResource ResourceKey="UserAvatarGradient" />
                                                        </Ellipse.Fill>
                                                    </Ellipse>
                                                    <TextBlock
                                                                HorizontalAlignment="Center"
                                                                FontSize="14"
                                                                FontWeight="SemiBold"
                                                                Foreground="White"
                                                                Text="Sarah Williams" />
                                                    <TextBlock
                                                                Margin="0,2,0,0"
                                                                HorizontalAlignment="Center"
                                                                FontSize="11"
                                                                Foreground="#D0FFFFFF"
                                                                Text="Chief Financial Officer" />
                                                </StackPanel>
                                            </Border>

                                            <TextBlock
                                                        Margin="16,0,0,20"
                                                        FontSize="11"
                                                        FontWeight="Bold"
                                                        Foreground="#90FFFFFF"
                                                        Text="NAVIGATION" />
                                            <RadioButton
                                                        Command="{Binding NavigateToDashboardCommand}"
                                                        Content="🏠  Dashboard"
                                                        GroupName="Navigation"
                                                        IsChecked="{Binding IsDashboardSelected}"
                                                        Style="{StaticResource ModernRadioButtonStyle}" />
                                            <RadioButton
                                                        Command="{Binding NavigateToChartOfAccountsCommand}"
                                                        Content="📊  Chart of Accounts"
                                                        GroupName="Navigation"
                                                        IsChecked="{Binding IsChartOfAccountsSelected}"
                                                        Style="{StaticResource ModernRadioButtonStyle}" />
                                            <RadioButton
                                                        Command="{Binding NavigateToTransactionsCommand}"
                                                        Content="💸  Transactions"
                                                        GroupName="Navigation"
                                                        IsChecked="{Binding IsTransactionsSelected}"
                                                        Style="{StaticResource ModernRadioButtonStyle}" />
                                            <RadioButton
                                                        Command="{Binding NavigateToReportsCommand}"
                                                        Content="📈  Financial Reports"
                                                        GroupName="Navigation"
                                                        IsChecked="{Binding IsReportsSelected}"
                                                        Style="{StaticResource ModernRadioButtonStyle}" />
                                            <RadioButton
                                                        Command="{Binding NavigateToAuditTrailsCommand}"
                                                        Content="🔍  Audit Trail"
                                                        GroupName="Navigation"
                                                        IsChecked="{Binding IsAuditTrailsSelected}"
                                                        Style="{StaticResource ModernRadioButtonStyle}" />

                                            <Rectangle
                                                        Height="1"
                                                        Margin="16,20"
                                                        Fill="#40FFFFFF"
                                                        RadiusX="0.5"
                                                        RadiusY="0.5" />

                                            <TextBlock
                                                        Margin="16,12,0,20"
                                                        FontSize="11"
                                                        FontWeight="Bold"
                                                        Foreground="#90FFFFFF"
                                                        Text="TOOLS" />
                                            <RadioButton
                                                        Command="{Binding NavigateToSettingsCommand}"
                                                        Content="⚙️  Settings"
                                                        GroupName="Navigation"
                                                        IsChecked="{Binding IsSettingsSelected}"
                                                        Style="{StaticResource ModernRadioButtonStyle}" />
                                            <RadioButton
                                                        Content="👥  User Management"
                                                        GroupName="Navigation"
                                                        IsChecked="{Binding IsUserManagementSelected}"
                                                        Style="{StaticResource ModernRadioButtonStyle}" />
                                            <RadioButton
                                                        Content="🔐  Security Center"
                                                        GroupName="Navigation"
                                                        IsChecked="{Binding IsSecurityCenterSelected}"
                                                        Style="{StaticResource ModernRadioButtonStyle}" />
                                            <RadioButton
                                                        Content="❓  Help and Support"
                                                        GroupName="Navigation"
                                                        IsChecked="{Binding IsHelpSupportSelected}"
                                                        Style="{StaticResource ModernRadioButtonStyle}" />
                                        </StackPanel>
                                    </ScrollViewer>

                                    <!--  Collapsed Sidebar Content  -->
                                    <StackPanel Margin="8,28,8,24" Visibility="{Binding CollapsedContentVisibility}">
                                        <Border
                                                    Margin="0,0,0,20"
                                                    Padding="8"
                                                    CornerRadius="12">
                                            <Border.Background>
                                                <StaticResource ResourceKey="UserProfileGradient" />
                                            </Border.Background>
                                            <Ellipse Width="32" Height="32">
                                                <Ellipse.Fill>
                                                    <StaticResource ResourceKey="UserAvatarGradient" />
                                                </Ellipse.Fill>
                                            </Ellipse>
                                        </Border>

                                        <RadioButton
                                                    Command="{Binding NavigateToDashboardCommand}"
                                                    Content="🏠"
                                                    GroupName="CollapsedNavigation"
                                                    IsChecked="{Binding IsDashboardSelected}"
                                                    Style="{StaticResource CollapsedRadioButtonStyle}"
                                                    ToolTip="Dashboard" />
                                        <RadioButton
                                                    Command="{Binding NavigateToChartOfAccountsCommand}"
                                                    Content="📊"
                                                    GroupName="CollapsedNavigation"
                                                    IsChecked="{Binding IsChartOfAccountsSelected}"
                                                    Style="{StaticResource CollapsedRadioButtonStyle}"
                                                    ToolTip="Chart of Accounts" />
                                        <RadioButton
                                                    Command="{Binding NavigateToTransactionsCommand}"
                                                    Content="💸"
                                                    GroupName="CollapsedNavigation"
                                                    IsChecked="{Binding IsTransactionsSelected}"
                                                    Style="{StaticResource CollapsedRadioButtonStyle}"
                                                    ToolTip="Transactions" />
                                        <RadioButton
                                                    Command="{Binding NavigateToReportsCommand}"
                                                    Content="📈"
                                                    GroupName="CollapsedNavigation"
                                                    IsChecked="{Binding IsReportsSelected}"
                                                    Style="{StaticResource CollapsedRadioButtonStyle}"
                                                    ToolTip="Financial Reports" />
                                        <RadioButton
                                                    Command="{Binding NavigateToAuditTrailsCommand}"
                                                    Content="🔍"
                                                    GroupName="CollapsedNavigation"
                                                    IsChecked="{Binding IsAuditTrailsSelected}"
                                                    Style="{StaticResource CollapsedRadioButtonStyle}"
                                                    ToolTip="Audit Trail" />

                                        <Rectangle
                                                    Height="1"
                                                    Margin="8,12,8,12"
                                                    Fill="#40FFFFFF"
                                                    RadiusX="0.5"
                                                    RadiusY="0.5" />

                                        <RadioButton
                                                    Command="{Binding NavigateToSettingsCommand}"
                                                    Content="⚙️"
                                                    GroupName="CollapsedNavigation"
                                                    IsChecked="{Binding IsSettingsSelected}"
                                                    Style="{StaticResource CollapsedRadioButtonStyle}"
                                                    ToolTip="Settings" />
                                        <RadioButton
                                                    Content="👥"
                                                    GroupName="CollapsedNavigation"
                                                    IsChecked="{Binding IsUserManagementSelected}"
                                                    Style="{StaticResource CollapsedRadioButtonStyle}"
                                                    ToolTip="User Management" />
                                        <RadioButton
                                                    Content="🔐"
                                                    GroupName="CollapsedNavigation"
                                                    IsChecked="{Binding IsSecurityCenterSelected}"
                                                    Style="{StaticResource CollapsedRadioButtonStyle}"
                                                    ToolTip="Security Center" />
                                        <RadioButton
                                                    Content="❓"
                                                    GroupName="CollapsedNavigation"
                                                    IsChecked="{Binding IsHelpSupportSelected}"
                                                    Style="{StaticResource CollapsedRadioButtonStyle}"
                                                    ToolTip="Help and Support" />
                                    </StackPanel>
                                </Grid>
                            </Border>
                        </Grid>

                        <!--  Navigation Frame - This replaces the hardcoded dashboard content  -->
                        <Grid Grid.Column="2">
                            <Frame
                                x:Name="MainContentFrame"
                                Background="Transparent"
                                BorderThickness="0"
                                NavigationUIVisibility="Hidden" />

                            <!-- Loading Overlay -->
                            <views:LoadingOverlay
                                x:Name="LoadingOverlay"
                                Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}"
                                Panel.ZIndex="1000" />
                        </Grid>
                    </Grid>
                </Grid>
            </fw:AcrylicPanel>
        </Grid>
    </Grid>
</Window>